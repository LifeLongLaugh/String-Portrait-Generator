<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>String Portrait Generator v1.2</title>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		:root {
			--primary: #4361ee;
			--primary-dark: #3a56d4;
			--secondary: #7209b7;
			--accent: #f72585;
			--dark: #1a1a2e;
			--darker: #0d0d19;
			--light: #f8f9fa;
			--gray: #6c757d;
			--light-gray: #e9ecef;
			--success: #4cc9f0;
			--warning: #f8961e;
			--card-bg: #ffffff;
			--shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
			--shadow-hover: 0 15px 35px rgba(0, 0, 0, 0.15);
			--transition: all 0.3s ease;
			--border-radius: 16px;
			--border-radius-sm: 8px;
		}

		* {
			box-sizing: border-box;
			font-family: 'Segoe UI', Tahoma, Verdana, sans-serif;
		}

		body {
			background: linear-gradient(135deg, var(--darker), var(--dark));
			color: var(--light);
			min-height: 100vh;
			padding: 20px;
			display: flex;
			justify-content: center;
			align-items: center;
		}

		#app {
			width: 100%;
			max-width: 1000px;
		}

		header {
			text-align: center;
			padding: 30px 20px;
			margin-bottom: 20px;
			position: relative;
		}

		h1 {
			font-size: 2.8rem;
			margin-bottom: 10px;
			background: linear-gradient(90deg, var(--success), var(--primary));
			-webkit-background-clip: text;
			background-clip: text;
			color: transparent;
		}

		.subtitle {
			font-size: 1.1rem;
			color: var(--light-gray);
			margin-bottom: 15px;
		}

		.version-badge {
			display: inline-block;
			background: rgba(76, 201, 240, 0.15);
			color: var(--success);
			padding: 6px 15px;
			border-radius: 50px;
			font-size: 0.9rem;
			font-weight: 600;
			margin-bottom: 10px;
			border: 1px solid rgba(76, 201, 240, 0.3);
		}

		.photo-section,
		.controls-section {
			background: rgba(255, 255, 255, 0.05);
			border-radius: var(--border-radius);
			padding: 25px;
			margin-bottom: 25px;
			box-shadow: var(--shadow);
			border: 1px solid rgba(255, 255, 255, 0.1);
		}

		.control-card {
			background: rgba(0, 0, 0, 0.2);
			padding: 18px;
			border-radius: var(--border-radius-sm);
			margin-bottom: 15px;
		}

		.control-card h4 {
			color: var(--success);
			margin-bottom: 15px;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.control-card h4 i {
			background: rgba(76, 201, 240, 0.15);
			width: 30px;
			height: 30px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.slider-group {
			margin-bottom: 15px;
		}

		.slider-group label {
			display: flex;
			justify-content: space-between;
			font-weight: 500;
			margin-bottom: 8px;
		}

		.slider-group span {
			color: var(--success);
			font-weight: 600;
		}

		input[type=range] {
			width: 100%;
			height: 8px;
			-webkit-appearance: none;
			background: rgba(255, 255, 255, 0.1);
			border-radius: 10px;
			outline: none;
		}

		input[type=range]::-webkit-slider-thumb {
			-webkit-appearance: none;
			width: 20px;
			height: 20px;
			background: var(--primary);
			border-radius: 50%;
			cursor: pointer;
			transition: var(--transition);
		}

		input[type=range]::-webkit-slider-thumb:hover {
			background: var(--primary-dark);
			transform: scale(1.1);
		}

		.action-buttons {
			display: grid;
			grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
			gap: 15px;
			margin-top: 20px;
		}

		button {
			padding: 14px;
			border-radius: var(--border-radius-sm);
			border: none;
			color: white;
			font-weight: 600;
			cursor: pointer;
			transition: var(--transition);
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
		}

		button:hover {
			transform: translateY(-3px);
			box-shadow: var(--shadow-hover);
		}

		#startBtn {
			background: #10b981;
		}

		#startBtn:hover {
			background: #059669;
		}

		#stopBtn {
			background: #f59e0b;
		}

		#stopBtn:hover {
			background: #d97706;
		}

		#resetBtn {
			background: #ef4444;
		}

		#resetBtn:hover {
			background: #dc2626;
		}

		#exportSeqBtn {
			background: #8b5cf6;
		}

		#exportSeqBtn:hover {
			background: #7c3aed;
		}

		#exportPNGBtn {
			background: #06b6d4;
		}

		#exportPNGBtn:hover {
			background: #0891b2;
		}

		.small {
			font-size: 13px;
			color: var(--light-gray);
		}

		.canvas-container {
			position: relative;
			height: 600px;
			border-radius: var(--border-radius-sm);
			overflow: hidden;
			background: rgba(0, 0, 0, 0.3);
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 15px 0;
		}

		canvas {
			background: #1e1e2e;
			max-width: 100%;
			max-height: 100%;
			box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
		}

		.status {
			padding: 10px;
			background: rgba(76, 201, 240, 0.1);
			border-radius: var(--border-radius-sm);
			text-align: center;
			font-weight: 500;
			margin: 15px 0;
		}

		.status span {
			color: var(--success);
			font-weight: 700;
		}

		.advanced {
			margin-top: 20px;
			background: rgba(0, 0, 0, 0.2);
			padding: 15px;
			border-radius: var(--border-radius-sm);
		}

		.row {
			display: flex;
			gap: 10px;
			align-items: center;
			margin-bottom: 10px;
		}

		.muted {
			color: var(--gray);
			font-size: 13px;
		}

		.credits {
			background: rgba(255, 255, 255, 0.05);
			border-radius: var(--border-radius);
			padding: 25px;
			margin: 25px 0;
			text-align: center;
			border-left: 4px solid var(--success);
		}

		.credits h3 {
			color: var(--success);
			margin-bottom: 15px;
		}

		.credits p {
			margin-bottom: 10px;
			line-height: 1.6;
		}

		.credits a {
			color: var(--success);
			text-decoration: none;
		}

		.credits a:hover {
			text-decoration: underline;
		}

		footer {
			margin-top: 30px;
			text-align: center;
			color: var(--gray);
			padding: 20px;
			border-top: 1px solid rgba(255, 255, 255, 0.1);
		}

		#noFearTolGroup {
			transition: opacity 0.18s linear;
		}

		.file-tip {
			background: rgba(76, 201, 240, 0.1);
			padding: 12px 15px;
			border-radius: var(--border-radius-sm);
			font-size: 0.9rem;
			color: var(--success);
			display: flex;
			align-items: center;
			gap: 10px;
			margin-bottom: 15px;
		}

		.position-tip {
			position: absolute;
			bottom: 15px;
			left: 15px;
			right: 15px;
			text-align: center;
			background: rgba(248, 150, 30, 0.15);
			color: var(--warning);
			padding: 10px;
			border-radius: var(--border-radius-sm);
			font-size: 0.9rem;
		}

		.control-section-title {
			font-size: 1.1rem;
			color: var(--success);
			margin: 20px 0 15px;
			padding-bottom: 8px;
			border-bottom: 1px solid rgba(255, 255, 255, 0.1);
		}

		/* Responsive styles */
		@media (max-width: 768px) {
			h1 {
				font-size: 2.2rem;
			}

			.canvas-container {
				height: 400px;
			}

			.controls-grid {
				grid-template-columns: 1fr !important;
			}

			.control-panel {
				flex-direction: column !important;
			}
		}

		@media (max-width: 480px) {
			h1 {
				font-size: 1.8rem;
			}

			.photo-section,
			.controls-section {
				padding: 20px;
			}

			.canvas-container {
				height: 300px;
			}

			button {
				padding: 12px;
				font-size: 0.9rem;
			}
		}
	</style>
</head>

<body>
	<div id="app">
		<header>
			<h1><i class="fas fa-paint-brush"></i> String Portrait Generator</h1>
			<div class="version-badge">v1.2 — Optimized Black-only engine</div>
			<p class="subtitle">L2 selection, precomputed line maps, No-Fear policy, occasional full pass</p>
		</header>

		<section class="photo-section">
			<div class="file-input-container">
				<div class="file-tip"><i class="fas fa-lightbulb"></i> Use high-contrast photos for best results</div>
				<input id="fileInput" type="file" accept="image/*" />
			</div>

			<h3><i class="fas fa-image"></i> Source Image</h3>
			<div class="canvas-container">
				<canvas id="imageCanvas" width="600" height="600"></canvas>
				<div class="position-tip">
					<i class="fas fa-hand-point-up"></i> Drag to position image inside the oval — use mouse wheel to
					zoom
				</div>
			</div>
		</section>

		<section class="controls-section">
			<h3><i class="fas fa-sliders-h"></i> Configuration & Mode</h3>
			<div class="control-card">
				<div class="row">
					<label style="min-width:120px">Mode</label>
					<select id="modeSelect">
						<option value="black">Black only</option>
						<option value="bw" disabled>Black & White (coming soon)</option>
						<option value="custom" disabled>Custom Colors (coming later)</option>
					</select>
					<div class="muted" style="margin-left:auto">Current: <span id="activeMode">Black only</span></div>
				</div>

				<div class="control-panel" style="display: flex; gap: 20px; margin-top: 20px;">
					<!-- Left Panel: Physical Configuration -->
					<div style="flex: 1;">
						<div class="control-section-title"><i class="fas fa-ruler-combined"></i> Physical Setup</div>

						<div class="control-card">
							<h4><i class="fas fa-expand-alt"></i> Oval Dimensions</h4>
							<div class="slider-group">
								<label>Width: <span id="ovalWval">100%</span></label>
								<input id="ovalW" type="range" min="10" max="100" value="100" />
							</div>
							<div class="slider-group">
								<label>Height: <span id="ovalHval">66%</span></label>
								<input id="ovalH" type="range" min="10" max="100" value="66" />
							</div>
						</div>

						<div class="control-card">
							<h4><i class="fas fa-thumbtack"></i> Nail Configuration</h4>
							<div class="slider-group">
								<label>Number of Nails: <span id="nailCountVal">180</span></label>
								<input id="nailCount" type="range" min="90" max="400" value="180" />
							</div>
						</div>

						<div class="control-card">
							<h4><i class="fas fa-thread"></i> Thread Properties</h4>
							<div class="slider-group">
								<label>Thread Thickness: <span id="thicknessVal">1</span></label>
								<input id="thickness" type="range" min="0.3" max="6" step="0.1" value="1" />
							</div>
							<div class="slider-group">
								<label>Max Strokes: <span id="maxLinesVal">3000</span></label>
								<input id="maxLines" type="range" min="50" max="8000" value="3000" />
							</div>
						</div>
					</div>

					<!-- Right Panel: Algorithm Configuration -->
					<div style="flex: 1;">
						<div class="control-section-title"><i class="fas fa-cogs"></i> Algorithm Settings</div>

						<div class="control-card">
							<h4><i class="fas fa-tachometer-alt"></i> Performance & Quality</h4>
							<div class="slider-group">
								<label>Per-stroke ADD (intensity): <span id="addVal">10</span></label>
								<input id="addAmount" type="range" min="1" max="40" value="10" />
							</div>

							<div class="slider-group">
								<label>Prefilter Downscale Factor: <span id="downscaleVal">6</span></label>
								<input id="downscale" type="range" min="2" max="12" value="6" />
							</div>

							<div class="slider-group">
								<label>Top-K Shortlist Size: <span id="topKVal">32</span></label>
								<input id="topK" type="range" min="4" max="128" step="4" value="32" />
							</div>
						</div>

						<div class="control-card">
							<h4><i class="fas fa-sync-alt"></i> Optimization & Recovery</h4>
							<div class="slider-group">
								<label>Global Pass Interval: <span id="globalIntervalVal">500</span></label>
								<input id="globalInterval" type="range" min="50" max="2000" step="50" value="500" />
							</div>

							<div id="noFearTolGroup">
								<div class="slider-group">
									<label>No-Fear Tolerance: <span id="noFearTolVal">-100</span></label>
									<input id="noFearTol" type="range" min="-1000" max="0" step="10" value="-100" />
								</div>
							</div>

							<div class="row">
								<label style="display:flex;align-items:center;gap:8px">
									<input id="noFear" type="checkbox" /> Enable No-Fear
								</label>
							</div>
						</div>

						<div class="control-card">
							<h4><i class="fas fa-microchip"></i> System Status</h4>
							<div class="row">
								<div class="muted">Precompute: <span id="precomputeStatus">Not computed</span></div>
								<div style="flex:1"></div>
								<button id="recomputeBtn" style="background:#8b5cf6">Recompute lines</button>
							</div>
						</div>
					</div>
				</div>

				<div class="action-buttons">
					<button id="startBtn"><i class="fas fa-play"></i> Start</button>
					<button id="stopBtn"><i class="fas fa-stop"></i> Stop</button>
					<button id="resetBtn"><i class="fas fa-redo"></i> Reset</button>
				</div>
			</div>
		</section>

		<section class="photo-section">
			<div class="canvas-status"
				style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
				<h3><i class="fas fa-palette"></i> Generated Thread Art</h3>
				<div class="status"><i class="fas fa-link"></i> Connections: <span id="connectionsCount">0</span></div>
			</div>

			<div class="canvas-container">
				<canvas id="workCanvas" width="600" height="600"></canvas>
			</div>
		</section>

		<section class="controls-section">
			<h3><i class="fas fa-download"></i> Export</h3>
			<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:15px">
				<button id="exportSeqBtn"><i class="fas fa-file-export"></i> Export Sequence (.txt)</button>
				<button id="exportPNGBtn"><i class="fas fa-image"></i> Export PNG</button>
			</div>
		</section>

		<div class="credits">
			<h3><i class="fas fa-heart"></i> Credits & Acknowledgments</h3>
			<p>This project was inspired by the work of <a href="https://pattvira.com/coding-tutorials/v/string-art" target="_blank">Patt Vira</a> and builds upon algorithms discussed by <a href="https://michael-crum.com/string_art_generator" target="_blank">Michael Crum</a>.</p>
			<p>Development was assisted by AI tools including ChatGPT, DeepSeek, and GitHub Copilot.</p>
			<!--<p class="small">Special thanks to the open source community for their valuable contributions and insights.
			</p>-->
		</div>

		<footer>
			<p class="small">&copy; 2025 String Portrait Generator | v1.2 Optimized Engine</p>
		</footer>
	</div>

	<script src="app.js"></script>
</body>

</html>